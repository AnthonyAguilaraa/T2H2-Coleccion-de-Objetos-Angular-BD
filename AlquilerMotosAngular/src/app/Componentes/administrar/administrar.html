<div class="admin-container">
  
  <div class="admin-header">
    <h2>âš™ï¸ Panel de AdministraciÃ³n</h2>
    <button *ngIf="vistaActual !== 'MENU'" (click)="cambiarVista('MENU')" class="btn-back">
      â¬… MenÃº
    </button>
  </div>

  <div *ngIf="vistaActual === 'MENU'" class="dashboard-grid">
    <div class="card-menu" (click)="cambiarVista('CLIENTES')">
      <div class="icon">ğŸ‘¤</div><h3>Clientes</h3>
    </div>
    <div class="card-menu" (click)="cambiarVista('VEHICULOS')">
      <div class="icon">ğŸš²</div><h3>VehÃ­culos</h3>
    </div>
    <div class="card-menu" (click)="cambiarVista('ALQUILERES')">
      <div class="icon">ğŸ“…</div><h3>Alquileres</h3>
    </div>
    <div class="card-menu" (click)="cambiarVista('DEVOLUCIONES')">
      <div class="icon">âœ…</div><h3>Devoluciones</h3>
    </div>
  </div>

  <div *ngIf="vistaActual === 'CLIENTES'" class="crud-panel">
    <h3>
      {{ editandoCliente ? 'âœï¸ Editando Cliente' : 'ğŸ‘¤ Nuevo Cliente' }}
    </h3>
    
    <div class="form-row">
      <input class="input" placeholder="Nombre" [(ngModel)]="formCliente.nombre">
      <input class="input" type="number" placeholder="Edad" [(ngModel)]="formCliente.edad">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="formCliente.esFrecuente"> VIP
      </label>
      
      <button class="btn-save" (click)="guardarCliente()">
        {{ editandoCliente ? 'Actualizar' : 'Agregar' }}
      </button>

      <button *ngIf="editandoCliente" class="btn-cancel" (click)="cancelarEdicion()">
        Cancelar
      </button>
    </div>

    <ul class="list-group">
      <li *ngFor="let c of clientes$ | async">
        <div class="info">
          <strong>{{c.nombre}}</strong> ({{c.edad}}) 
          <span class="tag vip" *ngIf="c.esFrecuente">VIP</span>
        </div>
        <div class="actions">
          <button class="btn-edit" (click)="cargarClienteParaEditar(c)">âœï¸</button>
         <button class="btn-delete" (click)="eliminarCliente(c._id!)">ğŸ—‘ï¸</button>
        </div>
      </li>
    </ul>
  </div>

  <div *ngIf="vistaActual === 'VEHICULOS'" class="crud-panel">
    <h3>
      {{ editandoVehiculo ? 'âœï¸ Editando VehÃ­culo' : 'ğŸš² Nuevo VehÃ­culo' }}
    </h3>

    <div class="form-row">
      <input class="input" placeholder="CÃ³digo" 
             [(ngModel)]="formVehiculo.codigo" 
             [readonly]="editandoVehiculo"
             [title]="editandoVehiculo ? 'El cÃ³digo no se puede cambiar' : ''">
             
      <input class="input" placeholder="Nombre" [(ngModel)]="formVehiculo.nombre">
      <input class="input" type="number" placeholder="Tarifa" [(ngModel)]="formVehiculo.tarifaDia">
      
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="formVehiculo.requiereEdad"> +18
      </label>

      <button class="btn-save" (click)="guardarVehiculo()">
        {{ editandoVehiculo ? 'Actualizar' : 'Agregar' }}
      </button>

      <button *ngIf="editandoVehiculo" class="btn-cancel" (click)="cancelarEdicion()">
        Cancelar
      </button>
    </div>

    <ul class="list-group">
      <li *ngFor="let v of vehiculos$ | async">
        <div class="info">
          <strong>[{{v.codigo}}]</strong> {{v.nombre}} - ${{v.tarifaDia}}
        </div>
        <div class="actions">
          <button class="btn-edit" (click)="cargarVehiculoParaEditar(v)">âœï¸</button>
          <button class="btn-delete" (click)="eliminarVehiculo(v.codigo)">ğŸ—‘ï¸</button>
        </div>
      </li>
    </ul>
  </div>

  <div *ngIf="vistaActual === 'ALQUILERES'" class="crud-panel">
    <h3>ğŸ“… Alquileres Activos</h3>
    <table class="admin-table">
      <thead><tr><th>Cliente</th><th>VehÃ­culo</th><th>Inicio</th><th>AcciÃ³n</th></tr></thead>
      <tbody>
        <ng-container *ngFor="let a of alquileres$ | async">
          <tr *ngIf="a.estado === 'ACTIVO'">
            <!-- <td>{{a.clienteId.nombre || 'Desconocido'}}</td> -->
<td>{{ getClienteNombre(a.clienteId) }}</td>

            <td>{{a.vehiculoCodigo}}</td>
            <td>{{a.fechaInicio | date:'dd/MM'}}</td>
            <td><button class="btn-delete-sm" (click)="eliminarAlquiler(a._id!)">Cancelar</button></td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
  
  </div>